# CompuStore Microservices Project

This repository contains two **Spring Boot** microservices that implement a simple product management system with user authentication and role‑based authorization.  The services are designed to run independently but work together to provide secure access to product data.  They use **JWT** (JSON Web Tokens) for stateless authentication and enforce access control with Spring Security.

## Services

### 1. `users‑service`

This service manages user accounts and issues JWTs.  It exposes endpoints to register new users, authenticate existing users and fetch the currently authenticated user’s profile.  Internally it uses MySQL to persist users and `BCryptPasswordEncoder` to hash passwords.

**Endpoints**

| Method | Endpoint                | Description                                    | Access   |
| ------ | ----------------------- | ---------------------------------------------- | -------- |
| POST   | `/api/users/register`   | Register a new user (username, password, role) | Public   |
| POST   | `/api/users/login`      | Authenticate a user and return a JWT           | Public   |
| GET    | `/api/users/profile`    | Retrieve the authenticated user’s details      | Requires JWT |

The JWT is generated by the service and includes the username and role claims.  The token is valid for 5 hours by default.  Configuration values such as the secret and validity period are externalised in `application.yml` and may be overridden with environment variables.

### 2. `products‑service`

This service provides CRUD operations on products.  It validates JWTs produced by the users‑service and enforces role‑based authorization.  A user with the `ADMIN` role can create, update and delete products; a `CLIENT` can only list and view them.

**Endpoints**

| Method | Endpoint                 | Description                                    | Required Role |
| ------ | ------------------------ | ---------------------------------------------- | ------------- |
| GET    | `/api/products`          | List all products                              | `ADMIN` or `CLIENT` |
| GET    | `/api/products/{id}`     | Get a single product by ID                    | `ADMIN` or `CLIENT` |
| POST   | `/api/products`          | Create a new product                          | `ADMIN` |
| PUT    | `/api/products/{id}`     | Update an existing product                    | `ADMIN` |
| DELETE | `/api/products/{id}`     | Delete a product                              | `ADMIN` |

## Building and Running

Both microservices are Maven projects.  The easiest way to build and run them together is with Docker Compose:

```bash
docker compose up --build
```

The compose file starts two MySQL containers (one for each service) and builds each microservice using the provided Dockerfiles.  Default ports:

- `users‑service`: http://localhost:8081
- `products‑service`: http://localhost:8082

You can override the database connection strings and JWT secret via environment variables defined in the `docker-compose.yml` file.

Once running you can:

1. Register a new user via `POST /api/users/register` with a JSON body `{ "username": "admin", "password": "secret", "role": "ADMIN" }`.
2. Log in via `POST /api/users/login` with `{ "username": "admin", "password": "secret" }`; the response contains a `token` field.
3. Use the token as a `Bearer` token in the `Authorization` header to call the products service.

## Design Notes

* **JWT generation** – The `users‑service` uses the `io.jsonwebtoken` library to generate tokens that contain the username and roles.  The token builder sets the subject, includes a comma‑separated list of authorities as a claim and sets the expiration time.  This pattern is described in the dev.to article on role‑based access control, where the `generateToken` method collects authorities, sets the subject and expiration, and signs the token with a secret key【923295981449190†L657-L669】.
* **Role‑based access control** – Endpoints in the products service use Spring Security’s `@PreAuthorize` annotation to restrict access.  The annotation checks that the authenticated user has the required role before proceeding.  The dev.to article demonstrates this pattern by annotating controller methods with `@PreAuthorize("hasRole('ADMIN')")` to ensure only admins can access certain routes【923295981449190†L1555-L1605】.
* **Dependencies** – Both services depend on `spring‑boot‑starter‑web`, `spring‑boot‑starter‑data‑jpa`, `spring‑boot‑starter‑security`, the MySQL JDBC driver and `io.jsonwebtoken`.  These dependencies mirror the setup recommended in the blog post on building a role‑based access control system【923295981449190†L202-L213】.

## Postman/Insomnia Collection

A sample Postman collection (`CompuStore.postman_collection.json`) is provided in the root of the repository.  Import it into Postman or Insomnia to test the full workflow.  It contains requests for registering users, logging in and performing product CRUD operations with the required Bearer tokens.

## License

This project is provided for educational purposes and carries no warranty.